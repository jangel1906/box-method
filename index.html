<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Manifest Box">
  <meta name="theme-color" content="#1e1b4b">
  <title>The Manifest Box</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(145deg, #1e1b4b 0%, #312e81 50%, #4c1d95 100%);
      min-height: 100vh;
      -webkit-tap-highlight-color: transparent;
    }

    @media (display-mode: standalone) { body { padding-top: env(safe-area-inset-top); } }

    .handwriting {
      font-family: 'Caveat', cursive;
      color: #1e40af;
    }

    .container { max-width: 400px; margin: 0 auto; padding: 1rem; min-height: 100vh; }

    /* Header */
    .header {
      text-align: center;
      padding: 1.5rem 0 1rem;
    }
    .header h1 {
      font-family: 'Caveat', cursive;
      font-size: 2.5rem;
      font-weight: 700;
      color: white;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    .header p {
      color: rgba(255,255,255,0.8);
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    /* Tabs */
    .tabs {
      display: flex;
      background: rgba(255,255,255,0.1);
      border-radius: 1rem;
      padding: 0.25rem;
      margin-bottom: 1rem;
    }
    .tab {
      flex: 1;
      padding: 0.75rem;
      border: none;
      background: transparent;
      color: rgba(255,255,255,0.7);
      font-size: 0.875rem;
      font-weight: 500;
      border-radius: 0.75rem;
      cursor: pointer;
      transition: all 0.3s;
    }
    .tab.active {
      background: white;
      color: #4c1d95;
    }

    /* Card */
    .card {
      background: linear-gradient(145deg, #fffbeb 0%, #fef3c7 100%);
      border-radius: 1rem;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      padding: 1.25rem;
      margin-bottom: 1rem;
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(
        transparent,
        transparent 27px,
        #e5e7eb 27px,
        #e5e7eb 28px
      );
      pointer-events: none;
      opacity: 0.5;
    }

    /* The Box */
    .box-wrapper {
      position: relative;
      width: 100%;
      max-width: 260px;
      aspect-ratio: 1;
      margin: 0.5rem auto 1rem;
    }
    .manifest-box {
      position: relative;
      width: 100%;
      height: 100%;
      border: 3px solid #1e40af;
      border-radius: 4px;
      background: rgba(255,255,255,0.5);
      transition: all 0.5s ease;
    }
    .manifest-box.sealed {
      box-shadow: 0 0 0 3px #f59e0b, 0 0 20px rgba(245,158,11,0.5);
      border-radius: 50%;
    }

    /* Corner Labels */
    .corner-num {
      position: absolute;
      width: 20px;
      height: 20px;
      background: #1e40af;
      color: white;
      font-size: 0.65rem;
      font-weight: 700;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    .num-1 { top: -10px; left: -10px; }
    .num-2 { top: -10px; right: -10px; }
    .num-3 { bottom: -10px; right: -10px; }
    .num-4 { bottom: -10px; left: -10px; }

    /* Corner Text - Handwriting */
    .corner-content {
      position: absolute;
      font-family: 'Caveat', cursive;
      font-size: 0.9rem;
      color: #1e40af;
      max-width: 45%;
      line-height: 1.2;
      overflow: hidden;
    }
    .content-1 { top: 8px; left: 8px; }
    .content-2 { top: 8px; right: 8px; text-align: right; }
    .content-3 { bottom: 8px; right: 8px; text-align: right; }
    .content-4 { bottom: 8px; left: 8px; }

    /* Writing Animation */
    .writing {
      display: inline-block;
      overflow: hidden;
      white-space: nowrap;
      animation: typing 1s steps(30) forwards;
      border-right: 2px solid #1e40af;
    }
    .writing.done {
      border-right: none;
      white-space: normal;
      animation: none;
    }
    @keyframes typing {
      from { width: 0; }
      to { width: 100%; }
    }

    /* Center Star */
    .center-star {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      font-size: 2.5rem;
      opacity: 0;
      transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .manifest-box.sealed .center-star {
      transform: translate(-50%, -50%) scale(1) rotate(360deg);
      opacity: 1;
    }

    /* Form Elements */
    .step-section { margin-bottom: 1.25rem; position: relative; z-index: 1; }
    .step-label {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .step-num {
      width: 24px;
      height: 24px;
      background: #1e40af;
      color: white;
      font-size: 0.75rem;
      font-weight: 700;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .step-title {
      font-weight: 600;
      color: #1e1b4b;
      font-size: 0.9rem;
    }
    .step-hint {
      font-size: 0.75rem;
      color: #6b7280;
      margin-bottom: 0.5rem;
      margin-left: 2rem;
    }

    .input-field {
      width: 100%;
      padding: 0.875rem;
      border: 2px solid #c7d2fe;
      border-radius: 0.5rem;
      font-family: 'Caveat', cursive;
      font-size: 1.25rem;
      color: #1e40af;
      background: white;
      transition: border-color 0.2s;
    }
    .input-field:focus {
      outline: none;
      border-color: #1e40af;
    }
    .input-field::placeholder {
      color: #a5b4fc;
    }

    /* Feelings */
    .feelings-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }
    .feeling-btn {
      padding: 0.6rem 0.25rem;
      border: 2px solid #c7d2fe;
      border-radius: 0.5rem;
      background: white;
      font-family: 'Caveat', cursive;
      font-size: 1rem;
      color: #4c1d95;
      cursor: pointer;
      transition: all 0.2s;
    }
    .feeling-btn.selected {
      border-color: #1e40af;
      background: #eef2ff;
      transform: scale(1.05);
    }

    /* Buttons */
    .btn {
      width: 100%;
      padding: 1rem;
      border: none;
      border-radius: 0.75rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      z-index: 1;
    }
    .btn:active { transform: scale(0.98); }
    .btn-primary {
      background: linear-gradient(135deg, #1e40af 0%, #4c1d95 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(30, 64, 175, 0.4);
    }
    .btn-primary:disabled { opacity: 0.5; }
    .btn-secondary {
      background: rgba(255,255,255,0.8);
      color: #4c1d95;
      margin-top: 0.5rem;
    }
    .btn-gold {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
    }

    /* Timer */
    .timer-display {
      text-align: center;
      padding: 2rem 0;
    }
    .timer-ring {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: conic-gradient(#1e40af var(--progress, 0%), #e5e7eb var(--progress, 0%));
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
    }
    .timer-inner {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .timer-num {
      font-family: 'Caveat', cursive;
      font-size: 4rem;
      font-weight: 700;
      color: #1e40af;
      line-height: 1;
    }
    .timer-text {
      font-size: 0.875rem;
      color: #6b7280;
    }
    .visualize-prompt {
      font-family: 'Caveat', cursive;
      font-size: 1.25rem;
      color: #1e1b4b;
      line-height: 1.5;
      position: relative;
      z-index: 1;
    }

    /* Release Animation */
    @keyframes sparkle-burst {
      0% { transform: scale(0) rotate(0deg); opacity: 1; }
      100% { transform: scale(2) rotate(180deg); opacity: 0; }
    }
    @keyframes float-away {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-80px) scale(0.5); opacity: 0; }
    }
    .sparkle {
      position: absolute;
      font-size: 1.5rem;
      animation: sparkle-burst 1s ease-out forwards;
    }
    .float-symbol {
      position: absolute;
      font-size: 1.5rem;
      animation: float-away 2s ease-out forwards;
    }

    /* Summary */
    .summary-box {
      background: white;
      border-radius: 0.75rem;
      padding: 1rem;
      margin: 1rem 0;
      position: relative;
      z-index: 1;
    }
    .summary-item {
      padding: 0.5rem 0;
      border-bottom: 1px dashed #e5e7eb;
    }
    .summary-item:last-child { border-bottom: none; }
    .summary-label {
      font-size: 0.65rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .summary-value {
      font-family: 'Caveat', cursive;
      font-size: 1.1rem;
      color: #1e40af;
    }

    /* History */
    .history-card {
      background: linear-gradient(145deg, #fffbeb 0%, #fef3c7 100%);
      border-radius: 1rem;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    }
    .history-header {
      text-align: center;
      margin-bottom: 0.75rem;
    }
    .history-date {
      font-size: 0.8rem;
      color: #6b7280;
      font-weight: 500;
    }
    .history-box {
      background: rgba(255, 255, 255, 0.7);
      border: 2px solid #1e40af;
      border-radius: 0.5rem;
      padding: 0.4rem;
    }
    .history-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.4rem;
    }
    .history-corner {
      background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
      border-radius: 0.4rem;
      padding: 0.6rem;
      position: relative;
    }
    .hc-num {
      position: absolute;
      top: -6px;
      width: 16px;
      height: 16px;
      background: #1e40af;
      color: white;
      font-size: 0.55rem;
      font-weight: 700;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .hc-tl .hc-num { left: -6px; }
    .hc-tr .hc-num { right: -6px; }
    .hc-bl .hc-num { left: -6px; }
    .hc-br .hc-num { right: -6px; }
    .hc-label {
      display: block;
      font-size: 0.55rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      margin-bottom: 0.15rem;
    }
    .hc-value {
      display: block;
      font-family: 'Caveat', cursive;
      font-size: 0.95rem;
      color: #1e40af;
      line-height: 1.2;
      word-break: break-word;
    }
    .empty-history {
      text-align: center;
      padding: 3rem 1rem;
      color: rgba(255,255,255,0.7);
    }
    .empty-history-icon { font-size: 3rem; margin-bottom: 1rem; }

    /* Tooltip System */
    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      background: linear-gradient(135deg, #a78bfa 0%, #7c3aed 100%);
      color: white;
      font-size: 0.65rem;
      font-weight: 700;
      border-radius: 50%;
      cursor: pointer;
      margin-left: 0.5rem;
      transition: all 0.2s;
      box-shadow: 0 2px 6px rgba(124, 58, 237, 0.3);
    }
    .help-icon:hover {
      transform: scale(1.1);
      box-shadow: 0 3px 10px rgba(124, 58, 237, 0.5);
    }
    .help-icon:active {
      transform: scale(0.95);
    }

    .tooltip-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      padding: 1rem;
    }
    .tooltip-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .tooltip-content {
      background: linear-gradient(145deg, #1e1b4b 0%, #312e81 50%, #4c1d95 100%);
      border-radius: 1rem;
      padding: 1.5rem;
      max-width: 320px;
      width: 100%;
      transform: scale(0.9) translateY(20px);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .tooltip-overlay.active .tooltip-content {
      transform: scale(1) translateY(0);
    }

    .tooltip-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.15);
    }
    .tooltip-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      border-radius: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }
    .tooltip-title {
      font-family: 'Caveat', cursive;
      font-size: 1.5rem;
      color: white;
      font-weight: 700;
    }

    .tooltip-body {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.875rem;
      line-height: 1.7;
    }
    .tooltip-body ul {
      list-style: none;
      padding: 0;
    }
    .tooltip-body li {
      padding: 0.4rem 0;
      padding-left: 1.5rem;
      position: relative;
    }
    .tooltip-body li::before {
      content: '‚ú®';
      position: absolute;
      left: 0;
      font-size: 0.75rem;
    }

    .tooltip-tap-hint {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.5);
    }

    /* Learn How It Works Button */
    .learn-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      width: 100%;
      padding: 0.75rem;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 0.75rem;
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 0.75rem;
      position: relative;
      z-index: 1;
    }
    .learn-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
    }
    .learn-btn:active {
      transform: scale(0.98);
    }
    .learn-btn-icon {
      font-size: 1rem;
    }

    /* Full Method Modal */
    .modal-content {
      background: linear-gradient(145deg, #1e1b4b 0%, #312e81 50%, #4c1d95 100%);
      border-radius: 1rem;
      padding: 1.5rem;
      max-width: 360px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      transform: scale(0.9) translateY(20px);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .tooltip-overlay.active .modal-content {
      transform: scale(1) translateY(0);
    }

    .modal-title {
      font-family: 'Caveat', cursive;
      font-size: 1.75rem;
      color: white;
      text-align: center;
      margin-bottom: 1rem;
    }

    .modal-section {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 0.75rem;
      padding: 1rem;
      margin-bottom: 0.75rem;
    }
    .modal-section-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    .modal-section-num {
      width: 24px;
      height: 24px;
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      color: white;
    }
    .modal-section-title {
      font-family: 'Caveat', cursive;
      font-size: 1.25rem;
      color: #fbbf24;
    }
    .modal-section-text {
      color: rgba(255, 255, 255, 0.85);
      font-size: 0.8rem;
      line-height: 1.6;
    }

    .modal-summary {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 0.75rem;
      padding: 1rem;
      margin-top: 0.5rem;
    }
    .modal-summary-title {
      font-family: 'Caveat', cursive;
      font-size: 1.25rem;
      color: #fbbf24;
      text-align: center;
      margin-bottom: 0.75rem;
    }
    .modal-summary-list {
      list-style: none;
      padding: 0;
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.8rem;
    }
    .modal-summary-list li {
      padding: 0.3rem 0;
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
    }
    .modal-summary-list li span:first-child {
      flex-shrink: 0;
    }

    /* Complete Screen */
    .complete-symbols {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }
    .complete-title {
      font-family: 'Caveat', cursive;
      font-size: 2rem;
      color: #1e1b4b;
      text-align: center;
      margin-bottom: 0.25rem;
    }
    .complete-msg {
      font-size: 0.8rem;
      color: #6b7280;
      text-align: center;
      line-height: 1.5;
      margin-bottom: 1rem;
      position: relative;
      z-index: 1;
    }

    /* Final Box - 4 Corners Display */
    .final-box {
      position: relative;
      background: rgba(255, 255, 255, 0.7);
      border: 3px solid #1e40af;
      border-radius: 0.75rem;
      padding: 0.5rem;
      margin-bottom: 1rem;
      z-index: 1;
    }
    .final-box-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.5rem;
    }
    .final-corner {
      background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
      border-radius: 0.5rem;
      padding: 0.75rem;
      position: relative;
    }
    .final-corner-num {
      position: absolute;
      top: -8px;
      width: 20px;
      height: 20px;
      background: #1e40af;
      color: white;
      font-size: 0.65rem;
      font-weight: 700;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .corner-tl .final-corner-num { left: -8px; }
    .corner-tr .final-corner-num { right: -8px; }
    .corner-bl .final-corner-num { left: -8px; }
    .corner-br .final-corner-num { right: -8px; }
    .final-corner-label {
      display: block;
      font-size: 0.6rem;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }
    .final-corner-value {
      display: block;
      font-family: 'Caveat', cursive;
      font-size: 1.1rem;
      color: #1e40af;
      line-height: 1.3;
    }
    .final-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2rem;
      background: white;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
      border: 2px solid #f59e0b;
      transition: all 0.5s ease;
    }
    .final-center.pulsing {
      animation: pulse-glow 1s ease-in-out infinite;
    }
    @keyframes pulse-glow {
      0%, 100% {
        transform: translate(-50%, -50%) scale(1);
        box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
      }
      50% {
        transform: translate(-50%, -50%) scale(1.15);
        box-shadow: 0 0 40px rgba(245, 158, 11, 0.8), 0 0 60px rgba(245, 158, 11, 0.4);
      }
    }
    .final-box.sealing {
      animation: box-glow 1.5s ease-in-out infinite;
    }
    @keyframes box-glow {
      0%, 100% {
        box-shadow: 0 0 10px rgba(245, 158, 11, 0.3);
      }
      50% {
        box-shadow: 0 0 30px rgba(245, 158, 11, 0.6), 0 0 50px rgba(124, 58, 237, 0.3);
      }
    }

    /* Progress */
    .progress-bar {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin: 0.75rem 0;
      position: relative;
      z-index: 5;
    }
    .progress-dot {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #c7d2fe;
      transition: all 0.3s;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 600;
      color: #6b7280;
      border: 2px solid transparent;
    }
    .progress-dot.active {
      background: #1e40af;
      color: white;
      transform: scale(1.1);
      border-color: #1e40af;
    }
    .progress-dot.done {
      background: #10b981;
      color: white;
      border-color: #10b981;
    }
    .progress-dot:hover {
      transform: scale(1.15);
      box-shadow: 0 0 12px rgba(30, 64, 175, 0.5);
    }
    .progress-dot.done:hover {
      box-shadow: 0 0 12px rgba(16, 185, 129, 0.5);
    }
    .progress-dot:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    const HISTORY_KEY = 'manifest-box-history';

    let currentView = 'create'; // 'create' or 'history'
    let currentStep = 0;
    let boxData = { desire: '', endScene: '', feeling: '', date: null };
    let timerSeconds = 60;
    let timerInterval = null;
    let isSealed = false;
    let history = loadHistory();

    const feelings = ['Excited', 'Grateful', 'Joyful', 'Relieved', 'Peaceful', 'Abundant', 'Loved', 'Free', 'Confident'];

    // Tooltip content data
    const tooltips = {
      1: {
        icon: '1',
        title: 'State Your Desire',
        items: [
          'Write in present tense as if it already happened',
          'This programs your subconscious mind to accept it as real',
          'Specificity and emotion amplify the signal to the universe'
        ]
      },
      2: {
        icon: '2',
        title: 'Visualize the Evidence',
        items: [
          'This is your "proof" - what you\'ll see when it manifests',
          'Creates a clear mental image for visualization',
          'The universe responds to clarity and detail'
        ]
      },
      3: {
        icon: '3',
        title: 'Emotional Alignment',
        items: [
          'Emotions are the language of manifestation',
          'Feeling the joy NOW raises your vibration to match your desire',
          'This is the most powerful step - emotion creates attraction'
        ]
      },
      4: {
        icon: '4',
        title: 'Release & Trust',
        items: [
          'Detachment allows the universe to deliver',
          'Obsessing blocks the flow - gratitude opens it',
          'Trust that it\'s already done'
        ]
      }
    };

    let activeTooltip = null;

    function showTooltip(step) {
      activeTooltip = step;
      render();
      setTimeout(() => {
        const overlay = document.querySelector('.tooltip-overlay');
        if (overlay) overlay.classList.add('active');
      }, 10);
    }

    function showFullMethod() {
      activeTooltip = 'full';
      render();
      setTimeout(() => {
        const overlay = document.querySelector('.tooltip-overlay');
        if (overlay) overlay.classList.add('active');
      }, 10);
    }

    function hideTooltip() {
      const overlay = document.querySelector('.tooltip-overlay');
      if (overlay) {
        overlay.classList.remove('active');
        setTimeout(() => {
          activeTooltip = null;
          render();
        }, 300);
      }
    }

    function goToStep(step) {
      // Allow going back to any previous step, or forward if requirements met
      if (step < currentStep) {
        currentStep = step;
        render();
      } else if (step === currentStep + 1 && canProceed()) {
        currentStep = step;
        render();
      }
    }

    function canProceed() {
      if (currentStep === 1) return boxData.desire.trim();
      if (currentStep === 2) return boxData.endScene.trim();
      if (currentStep === 3) return boxData.feeling;
      return true;
    }

    function renderTooltipOverlay() {
      if (!activeTooltip) return '';

      if (activeTooltip === 'full') {
        return `
          <div class="tooltip-overlay" onclick="hideTooltip()">
            <div class="modal-content" onclick="event.stopPropagation()">
              <div class="modal-title">How The Manifest Box Works</div>

              <div class="modal-section">
                <div class="modal-section-header">
                  <span class="modal-section-num">1</span>
                  <span class="modal-section-title">Your Desire</span>
                </div>
                <p class="modal-section-text">Write what you want in present tense, as if it just happened. This programs your subconscious to accept it as real.</p>
              </div>

              <div class="modal-section">
                <div class="modal-section-header">
                  <span class="modal-section-num">2</span>
                  <span class="modal-section-title">End Scene</span>
                </div>
                <p class="modal-section-text">Describe what you'll see as proof. The universe responds to clarity - give it a clear target.</p>
              </div>

              <div class="modal-section">
                <div class="modal-section-header">
                  <span class="modal-section-num">3</span>
                  <span class="modal-section-title">Your Feeling</span>
                </div>
                <p class="modal-section-text">Emotions are the language of manifestation. Feeling it NOW raises your vibration to match your desire.</p>
              </div>

              <div class="modal-section">
                <div class="modal-section-header">
                  <span class="modal-section-num">4</span>
                  <span class="modal-section-title">Let + Allow</span>
                </div>
                <p class="modal-section-text">Release attachment. Obsessing blocks the flow - trust and gratitude open it.</p>
              </div>

              <div class="modal-summary">
                <div class="modal-summary-title">The Complete Picture</div>
                <ul class="modal-summary-list">
                  <li><span>1Ô∏è‚É£</span> <span>Sets your <strong>INTENTION</strong> (What you want)</span></li>
                  <li><span>2Ô∏è‚É£</span> <span>Creates your <strong>VISION</strong> (Evidence)</span></li>
                  <li><span>3Ô∏è‚É£</span> <span>Generates your <strong>VIBRATION</strong> (Feeling)</span></li>
                  <li><span>4Ô∏è‚É£</span> <span>Enables <strong>RECEIVING</strong> (Release)</span></li>
                  <li><span>‚è±Ô∏è</span> <span>60s visualization locks it into your subconscious</span></li>
                  <li><span>‚≠ê</span> <span>The seal activates and releases it to the universe</span></li>
                </ul>
              </div>

              <p class="tooltip-tap-hint">Tap anywhere to close</p>
            </div>
          </div>
        `;
      }

      const tip = tooltips[activeTooltip];
      return `
        <div class="tooltip-overlay" onclick="hideTooltip()">
          <div class="tooltip-content" onclick="event.stopPropagation()">
            <div class="tooltip-header">
              <div class="tooltip-icon">${tip.icon}</div>
              <div class="tooltip-title">${tip.title}</div>
            </div>
            <div class="tooltip-body">
              <ul>
                ${tip.items.map(item => `<li>${item}</li>`).join('')}
              </ul>
            </div>
            <p class="tooltip-tap-hint">Tap anywhere to close</p>
          </div>
        </div>
      `;
    }

    function loadHistory() {
      try {
        return JSON.parse(localStorage.getItem(HISTORY_KEY)) || [];
      } catch { return []; }
    }

    function saveHistory() {
      localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
    }

    function addToHistory() {
      history.unshift({
        id: Date.now(),
        ...boxData,
        date: new Date().toISOString()
      });
      saveHistory();
    }

    function updateField(field, value) {
      boxData[field] = value;
      const btn = document.querySelector('.btn-primary');
      if (btn) {
        if (field === 'desire') btn.disabled = !value.trim();
        if (field === 'endScene') btn.disabled = !value.trim();
      }
    }

    function selectFeeling(f) {
      boxData.feeling = f;
      render();
    }

    function nextStep() {
      if (currentStep === 1 && !boxData.desire.trim()) return;
      if (currentStep === 2 && !boxData.endScene.trim()) return;
      if (currentStep === 3 && !boxData.feeling) return;
      currentStep++;
      render();
    }

    function prevStep() {
      if (currentStep > 0) { currentStep--; render(); }
    }

    function startTimer() {
      currentStep = 5;
      timerSeconds = 60;
      render();
      timerInterval = setInterval(() => {
        timerSeconds--;
        if (timerSeconds <= 0) {
          clearInterval(timerInterval);
          currentStep = 6;
        }
        render();
      }, 1000);
    }

    function sealBox() {
      isSealed = true;
      render();
      setTimeout(() => {
        addToHistory();
        currentStep = 7;
        render();
      }, 2000);
    }

    function startNew() {
      currentStep = 0;
      boxData = { desire: '', endScene: '', feeling: '', date: null };
      timerSeconds = 60;
      isSealed = false;
      if (timerInterval) clearInterval(timerInterval);
      render();
    }

    function setView(v) {
      currentView = v;
      render();
    }

    function deleteHistoryItem(id, e) {
      e.stopPropagation();
      history = history.filter(h => h.id !== id);
      saveHistory();
      render();
    }

    function renderBox(animated = false) {
      return `
        <div class="box-wrapper">
          <div class="manifest-box ${isSealed ? 'sealed' : ''}">
            <span class="corner-num num-1">1</span>
            <span class="corner-num num-2">2</span>
            <span class="corner-num num-3">3</span>
            <span class="corner-num num-4">4</span>

            ${boxData.desire ? `<span class="corner-content content-1 ${animated ? 'writing' : ''}">${boxData.desire}</span>` : ''}
            ${boxData.endScene ? `<span class="corner-content content-2 ${animated ? 'writing' : ''}">${boxData.endScene}</span>` : ''}
            ${boxData.feeling ? `<span class="corner-content content-3 ${animated ? 'writing' : ''}">Feeling: ${boxData.feeling}</span>` : ''}
            <span class="corner-content content-4">Let + Allow</span>

            <span class="center-star">‚≠ê</span>
          </div>
        </div>
      `;
    }

    function render() {
      const app = document.getElementById('app');
      let html = '';

      // Header
      html += `
        <div class="container">
          <div class="header">
            <h1>The Manifest Box</h1>
            <p>${currentView === 'history' ? 'Your manifestation history' : 'Write your reality'}</p>
          </div>
          <div class="tabs">
            <button class="tab ${currentView === 'create' ? 'active' : ''}" onclick="setView('create')">Create</button>
            <button class="tab ${currentView === 'history' ? 'active' : ''}" onclick="setView('history')">History (${history.length})</button>
          </div>
      `;

      // History View
      if (currentView === 'history') {
        if (history.length === 0) {
          html += `
            <div class="empty-history">
              <div class="empty-history-icon">üì¶</div>
              <p>No manifestations yet.<br>Create your first one!</p>
            </div>
          `;
        } else {
          history.forEach(item => {
            const date = new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            html += `
              <div class="history-card">
                <div class="history-header">
                  <span class="history-date">‚≠ê ${date}</span>
                </div>
                <div class="history-box">
                  <div class="history-grid">
                    <div class="history-corner hc-tl">
                      <span class="hc-num">1</span>
                      <span class="hc-label">Desire</span>
                      <span class="hc-value">${item.desire}</span>
                    </div>
                    <div class="history-corner hc-tr">
                      <span class="hc-num">2</span>
                      <span class="hc-label">End Scene</span>
                      <span class="hc-value">${item.endScene}</span>
                    </div>
                    <div class="history-corner hc-bl">
                      <span class="hc-num">4</span>
                      <span class="hc-label">Released</span>
                      <span class="hc-value">‚ú® Done</span>
                    </div>
                    <div class="history-corner hc-br">
                      <span class="hc-num">3</span>
                      <span class="hc-label">Feeling</span>
                      <span class="hc-value">${item.feeling}</span>
                    </div>
                  </div>
                </div>
              </div>
            `;
          });
        }
        html += `</div>`;
        app.innerHTML = html;
        return;
      }

      // Create View - Steps
      if (currentStep === 0) {
        html += `
          <div class="card">
            ${renderBox()}
            <p style="text-align: center; font-family: 'Caveat', cursive; font-size: 1.25rem; color: #4c1d95; margin-bottom: 1rem; position: relative; z-index: 1;">
              Create your visual script to manifest your desires
            </p>
            <button class="btn btn-primary" onclick="nextStep()">Begin Writing</button>
            <button class="learn-btn" onclick="showFullMethod()">
              <span class="learn-btn-icon">‚ú®</span>
              Learn How This Works
            </button>
          </div>
        `;
      }

      else if (currentStep === 1) {
        html += `
          <div class="card">
            ${renderBox()}
            <div class="progress-bar">
              <div class="progress-dot active" onclick="goToStep(1)">1</div>
              <div class="progress-dot" onclick="goToStep(2)">2</div>
              <div class="progress-dot" onclick="goToStep(3)">3</div>
              <div class="progress-dot" onclick="goToStep(4)">4</div>
            </div>
            <div class="step-section">
              <div class="step-label">
                <span class="step-num">1</span>
                <span class="step-title">Your Desire</span>
                <span class="help-icon" onclick="showTooltip(1)">?</span>
              </div>
              <p class="step-hint">Write in present tense, as if it just happened</p>
              <textarea class="input-field" rows="2" placeholder="I just received $10,000 easily!" oninput="updateField('desire', this.value)">${boxData.desire}</textarea>
            </div>
            <button class="btn btn-primary" onclick="nextStep()" ${!boxData.desire.trim() ? 'disabled' : ''}>Next</button>
            <button class="btn btn-secondary" onclick="prevStep()">Back</button>
          </div>
        `;
      }

      else if (currentStep === 2) {
        html += `
          <div class="card">
            ${renderBox(true)}
            <div class="progress-bar">
              <div class="progress-dot done" onclick="goToStep(1)">1</div>
              <div class="progress-dot active" onclick="goToStep(2)">2</div>
              <div class="progress-dot" onclick="goToStep(3)">3</div>
              <div class="progress-dot" onclick="goToStep(4)">4</div>
            </div>
            <div class="step-section">
              <div class="step-label">
                <span class="step-num">2</span>
                <span class="step-title">End Scene</span>
                <span class="help-icon" onclick="showTooltip(2)">?</span>
              </div>
              <p class="step-hint">What evidence will you see when it manifests?</p>
              <textarea class="input-field" rows="2" placeholder="Bank account shows +$10,000" oninput="updateField('endScene', this.value)">${boxData.endScene}</textarea>
            </div>
            <button class="btn btn-primary" onclick="nextStep()" ${!boxData.endScene.trim() ? 'disabled' : ''}>Next</button>
            <button class="btn btn-secondary" onclick="prevStep()">Back</button>
          </div>
        `;
      }

      else if (currentStep === 3) {
        html += `
          <div class="card">
            ${renderBox(true)}
            <div class="progress-bar">
              <div class="progress-dot done" onclick="goToStep(1)">1</div>
              <div class="progress-dot done" onclick="goToStep(2)">2</div>
              <div class="progress-dot active" onclick="goToStep(3)">3</div>
              <div class="progress-dot" onclick="goToStep(4)">4</div>
            </div>
            <div class="step-section">
              <div class="step-label">
                <span class="step-num">3</span>
                <span class="step-title">Your Feeling</span>
                <span class="help-icon" onclick="showTooltip(3)">?</span>
              </div>
              <p class="step-hint">How will you feel when this manifests?</p>
              <div class="feelings-grid">
                ${feelings.map(f => `
                  <button class="feeling-btn ${boxData.feeling === f ? 'selected' : ''}" onclick="selectFeeling('${f}')">${f}</button>
                `).join('')}
              </div>
            </div>
            <button class="btn btn-primary" onclick="nextStep()" ${!boxData.feeling ? 'disabled' : ''}>Next</button>
            <button class="btn btn-secondary" onclick="prevStep()">Back</button>
          </div>
        `;
      }

      else if (currentStep === 4) {
        html += `
          <div class="card">
            ${renderBox(true)}
            <div class="progress-bar">
              <div class="progress-dot done" onclick="goToStep(1)">1</div>
              <div class="progress-dot done" onclick="goToStep(2)">2</div>
              <div class="progress-dot done" onclick="goToStep(3)">3</div>
              <div class="progress-dot active" onclick="goToStep(4)">4</div>
            </div>
            <div class="step-section">
              <div class="step-label">
                <span class="step-num">4</span>
                <span class="step-title">Let + Allow</span>
                <span class="help-icon" onclick="showTooltip(4)">?</span>
              </div>
              <div style="background: #eef2ff; border-radius: 0.5rem; padding: 1rem; text-align: center; position: relative; z-index: 1;">
                <p style="font-family: 'Caveat', cursive; font-size: 1.5rem; color: #1e40af;">Release & Trust</p>
                <p style="font-size: 0.8rem; color: #6b7280; margin-top: 0.25rem;">Focus on gratitude. Let the universe deliver.</p>
              </div>
            </div>
            <button class="btn btn-primary" onclick="startTimer()">Start 60s Visualization</button>
            <button class="btn btn-secondary" onclick="prevStep()">Back</button>
          </div>
        `;
      }

      else if (currentStep === 5) {
        const progress = ((60 - timerSeconds) / 60) * 100;
        html += `
          <div class="card">
            <div class="timer-display">
              <div class="timer-ring" style="--progress: ${progress}%;">
                <div class="timer-inner">
                  <span class="timer-num">${timerSeconds}</span>
                  <span class="timer-text">seconds</span>
                </div>
              </div>
              <p class="visualize-prompt">
                Close your eyes...<br>
                See your <strong>${boxData.endScene}</strong><br>
                Feel the <strong>${boxData.feeling}</strong><br>
                It is already yours.
              </p>
            </div>
          </div>
        `;
      }

      else if (currentStep === 6) {
        html += `
          <div class="card" style="position: relative; overflow: visible;">
            ${isSealed ? `
              <span class="sparkle" style="top: 5%; left: 10%;">‚ú®</span>
              <span class="sparkle" style="top: 10%; right: 10%; animation-delay: 0.2s;">‚≠ê</span>
              <span class="sparkle" style="top: 25%; left: 5%; animation-delay: 0.4s;">üí´</span>
              <span class="sparkle" style="top: 20%; right: 5%; animation-delay: 0.6s;">üåü</span>
              <span class="float-symbol" style="top: 15%; left: 45%;">üïäÔ∏è</span>
              <span class="float-symbol" style="top: 18%; left: 55%; animation-delay: 0.3s;">üíú</span>
            ` : ''}

            <p style="text-align: center; font-family: 'Caveat', cursive; font-size: 1.5rem; color: #1e40af; margin-bottom: 0.75rem; position: relative; z-index: 1;">
              ${isSealed ? '‚ú® Releasing to the Universe...' : 'Your Manifest Box is Ready'}
            </p>

            <div class="final-box ${isSealed ? 'sealing' : ''}">
              <div class="final-box-grid">
                <div class="final-corner corner-tl">
                  <span class="final-corner-num">1</span>
                  <span class="final-corner-label">Your Desire</span>
                  <span class="final-corner-value">${boxData.desire}</span>
                </div>
                <div class="final-corner corner-tr">
                  <span class="final-corner-num">2</span>
                  <span class="final-corner-label">End Scene</span>
                  <span class="final-corner-value">${boxData.endScene}</span>
                </div>
                <div class="final-corner corner-bl">
                  <span class="final-corner-num">4</span>
                  <span class="final-corner-label">Let + Allow</span>
                  <span class="final-corner-value">${isSealed ? 'Releasing... üïäÔ∏è' : 'Ready to Release'}</span>
                </div>
                <div class="final-corner corner-br">
                  <span class="final-corner-num">3</span>
                  <span class="final-corner-label">Feeling</span>
                  <span class="final-corner-value">${boxData.feeling}</span>
                </div>
              </div>
              <div class="final-center ${isSealed ? 'pulsing' : ''}">‚≠ê</div>
            </div>

            <button class="btn btn-gold" onclick="sealBox()" ${isSealed ? 'disabled' : ''}>
              ${isSealed ? 'üïäÔ∏è Releasing...' : 'üïäÔ∏è Seal & Release'}
            </button>
          </div>
        `;
      }

      else if (currentStep === 7) {
        html += `
          <div class="card">
            <div class="complete-symbols">
              <span>üåü</span><span>üïäÔ∏è</span><span>üíú</span><span>‚ú®</span><span>ü¶ã</span>
            </div>
            <div class="complete-title">It Is Done</div>
            <p class="complete-msg">
              Your manifestation has been sealed and released to the universe.<br>
              Let go. Trust. Focus on gratitude.
            </p>

            <div class="final-box">
              <div class="final-box-grid">
                <div class="final-corner corner-tl">
                  <span class="final-corner-num">1</span>
                  <span class="final-corner-label">Your Desire</span>
                  <span class="final-corner-value">${boxData.desire}</span>
                </div>
                <div class="final-corner corner-tr">
                  <span class="final-corner-num">2</span>
                  <span class="final-corner-label">End Scene</span>
                  <span class="final-corner-value">${boxData.endScene}</span>
                </div>
                <div class="final-corner corner-bl">
                  <span class="final-corner-num">4</span>
                  <span class="final-corner-label">Let + Allow</span>
                  <span class="final-corner-value">Released ‚ú®</span>
                </div>
                <div class="final-corner corner-br">
                  <span class="final-corner-num">3</span>
                  <span class="final-corner-label">Feeling</span>
                  <span class="final-corner-value">${boxData.feeling}</span>
                </div>
              </div>
              <div class="final-center">‚≠ê</div>
            </div>

            <button class="btn btn-primary" onclick="startNew()">New Manifestation</button>
          </div>
        `;
      }

      html += `</div>`;

      // Add tooltip overlay
      html += renderTooltipOverlay();

      app.innerHTML = html;

      // Mark writing animations as done after delay
      setTimeout(() => {
        document.querySelectorAll('.writing').forEach(el => el.classList.add('done'));
      }, 1000);
    }

    render();
  </script>
</body>
</html>
